<div class="container">
  <div class="page-header primary-color">
    <h1>Find Fresh Food
    </h1>
  </div>

  <div class="row">
    <div class="col-md-4">
      <div class="col-md-12 header">
        <h3 class="text-muted">Filters</h3>
      </div>

      <%= search_form_for @q do |f| %>
          <div class="col-md-12">
            <h4 class="text-muted">Starts Before</h4>
            <%= f.search_field :shares_start_date_lteq, class: 'form-control datepicker' %>
          </div>

          <div class="col-md-12">
            <h4 class="text-muted">City or State</h4>
            <%= f.search_field :city_or_state_or_zipcode_cont, class: 'form-control', placeholder: request.location.city rescue "City or State" %>
          </div>

          <div class="col-md-12">
            <h4 class="text-muted">Specifc Location</h4>
            Mile Radius <%= text_field_tag :miles, params[:miles], class: 'form-control' %>
            From <%= text_field_tag :zipcode, params[:zipcode], class: 'form-control', placeholder: 'Zipcode' %>
          </div>

          <div class="col-md-12">
            <%= f.check_box :shares_organic_true %> Organic?
          </div>

          <div class="col-md-12">
            <%= f.check_box :shares_taking_orders_true %> Taking Orders?
          </div>

          <div class="col-md-12">
            <h4 class="text-muted">Season</h4>
            <%= f.select :shares_season_cont, Share::VALID_SEASONS, {include_blank: true}, class: 'form-control' %>
          </div>

          <div class="col-md-12">
            <h4 class="text-muted">Price Range</h4>
            <div id="the_slider"></div>
            <br>
            <%= f.hidden_field :shares_price_gteq %>
            <%= f.hidden_field :shares_price_lteq %>
            <input type="text" id="amount" readonly style="border:0; color:dimgray; font-weight:bold;text-align: center;
                width: 100%;">

            <h4 class="text-muted">Pick-up Locations</h4>
            <div class="col-md-12">
              <h4 class="text-muted">City or State</h4>
              <%= f.search_field :shares_locations_city_or_state_or_zipcode_cont, class: 'form-control', placeholder: request.location.city rescue "City or State" %>
            </div>

            <div class="col-md-12">
              <h4 class="text-muted">Specifc Location</h4>
              Mile Radius <%= text_field_tag :pickup_miles, params[:pickup_miles], class: 'form-control' %>
              From <%= text_field_tag :pickup_zipcode, params[:pickup_zipcode], class: 'form-control', placeholder: 'Zipcode' %>
            </div>
          </div>
          <br>


          <div class="col-md-12">
            <h4 class="text-muted">Add Ons</h4>
            <%= f.select :add_ons_item_eq, valid_add_ons, {include_blank: true}, class: 'form-control' %>
          </div>


          <div class="col-md-12 text-center" style="padding: 25px;">
            <%= f.submit "Search", class: 'btn btn-lg btn-success' %>
          </div>
      <% end %>

    </div>

    <div class="col-md-8">
      <div class="header">
        <h3 class="text-muted text-right">Results</h3>
      </div>
      <% @farms.each do |f| %>
          <div class="row" style="border: 1px solid lightgray !important; margin-top: 5px;background-color: white">
            <div class="col-md-9 thumbnail" style="margin-bottom:0px; border:none !important;">
              <div class="row">
                <div class="col-md-4" style="padding-left: 23px; padding-right: 0px;">
                  <h4 class="primary-color"><%= link_to f.name, farm_path(f) %></h4>
                  <p class="text-muted"><%= f.city %>, <%= f.state %></p>
                  <%= link_to 'Learn more', farm_path(f), class: 'btn btn-primary-invert text-center' %>
                </div>
                <div class="col-md-8">
                  <% f.shares.each do |share| %>
                      <p class="text-muted" style="padding-top: 10px;">Offering:
                        <% share.vegetables.each do |v| %>
                            <span class="primary-color"><%= v %></span>

                        <% end %>

                        <span class="text-muted pull-right">$<%= share.price %></span>
                      </p>
                  <% end %>
                </div>
                <% f.shares.each do |share| %>
                    <div class="col-md-8 table-responsive">
                      <table class="table table-hover" style="margin-bottom:0px;">
                        <tr>
                          <th class="text-muted text-right">Organic</th>
                          <th class="text-muted text-center">Taking Orders</th>
                          <th class="text-muted">Season</th>
                          <th class="text-muted text-right">Duration</th>
                        </tr>
                        <tr>
                          <td class="text-right">
                            <% if share.organic == true %>
                                <%= fa_icon('check', class: 'primary-color') %>
                            <% else %>
                                <%= fa_icon('times', class: 'text-muted') %>
                            <% end %>
                          </td>
                          <td class="text-center">
                            <% if share.taking_orders == true %>
                                <%= fa_icon('check', class: 'primary-color') %>
                            <% else %>
                                <%= fa_icon('times', class: 'text-muted') %>
                            <% end %>
                          </td>
                          <td class="primary-color"><%= share.season %></td>
                          <td class="primary-color text-right"><%= share.weeks %>
                            <small>weeks</small>
                          </td>
                        </tr>
                      </table>
                    </div>
                <% end %>
              </div>
            </div>
            <div class="col-md-3 thumbnail" style="margin-bottom:0px; border: none !important;">
              <% if f.farm_photos.last.nil? %>
                  <%= fa_icon('leaf', class: 'primary-color no-photo-index') %>
              <% else %>
                  <%= image_tag(f.farm_photos.last.image(:medium)) rescue nil %>
              <% end %>
            </div>

          </div>
      <% end %>
    </div>
  </div>
</div>
